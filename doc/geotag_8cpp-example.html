<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> <!--*- sgml -*-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="author" content="Andreas Huggel and Exiv2 contributors">
  <meta name="description" content="Open Source Exif, IPTC and XMP metadata library and tools with Exif MakerNote and read/write support">
  <meta name="keywords" content="exif, iptc, xmp, metadata, makernote, manipulation, manipulate, read and write, write, change, update, jpeg, jpg, ifd, image file directory, thumbnail, thumbnails, tag, tags, canon, fujifilm, sigma/foveon, nikon, open source, opensource, huggel, andreas, andreas huggel">
  <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="manifest" href="/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <title>Exiv2 - Image metadata library and tools</title>
  <!-- Doxygen styles -->
  <link href="doxygen.css" rel="stylesheet" type="text/css">
  <link href="customdoxygen.css" rel="stylesheet" type="text/css">
  <!-- Bootstrap core CSS -->
  <link href="../dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap theme -->
  <link href="../dist/css/bootstrap-theme.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="../include/exiv2.css" rel="stylesheet">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<!-- Bootstrap core JavaScript
================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../dist/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../dist/assets/js/ie10-viewport-bug-workaround.js"></script>
<!-- Custom script to bootstrap (augment) Doxygen-generated HTML -->
<script type="text/javascript" src="doxy-boot.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<body>
<nav class="navbar navbar-default navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img alt="Exiv2" src="../include/exiv2-logo-small.png">
      </a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="../getting-started.html">Getting started</a></li>
        <li><a href="../download.html">Download</a></li>
        <li><a href="../whatsnew.html">What's New</a></li>
        <li><a href="../metadata.html">Metadata</a></li>
        <li><a href="../makernote.html">Makernote</a></li>
        <li><a href="../doc/examples.html">Examples</a></li>
        <li><a href="../doc/index.html">API</a></li>
        <li><a href="../manpage.html">Manual</a></li>
        <li><a href="book/index.html">Book</a></li>
        <li><a href="https://github.com/exiv2/exiv2" target="_blank">GitHub</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>
<div class="container">
<div><!-- top -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">geotag.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Reads GPX data and updates images with GPS Tags</p>
<div class="fragment"><div class="line"><span class="comment">// ***************************************************************** -*- C++ -*-</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2004-2021 Exiv2 authors</span></div>
<div class="line"><span class="comment"> * This program is part of the Exiv2 distribution.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> * modify it under the terms of the GNU General Public License</span></div>
<div class="line"><span class="comment"> * as published by the Free Software Foundation; either version 2</span></div>
<div class="line"><span class="comment"> * of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, 5th Floor, Boston, MA 02110-1301 USA.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment">// geotag.cpp</span></div>
<div class="line"><span class="comment">// Sample program to read gpx files and update images with GPS tags</span></div>
<div class="line"><span class="comment">// g++ geotag.cpp -o geotag -lexiv2 -lexpat</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;exiv2/exiv2.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;unused.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;expat.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if defined(__MINGW32__) || defined(__MINGW64__)</span></div>
<div class="line"><span class="preprocessor"># ifndef  __MINGW__</span></div>
<div class="line"><span class="preprocessor">#  define __MINGW__</span></div>
<div class="line"><span class="preprocessor"># endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef  lengthof</span></div>
<div class="line"><span class="preprocessor">#define  lengthof(x) (sizeof(*x)/sizeof(x))</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if defined(_MSC_VER) || defined(__MINGW__)</span></div>
<div class="line"><span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><span class="keywordtype">char</span>*    realpath(<span class="keyword">const</span> <span class="keywordtype">char</span>* file,<span class="keywordtype">char</span>* path);</div>
<div class="line"><span class="preprocessor">#define  lstat _stat</span></div>
<div class="line"><span class="preprocessor">#define  stat  _stat</span></div>
<div class="line"><span class="preprocessor">#if      _MSC_VER &lt; 1400</span></div>
<div class="line"><span class="preprocessor">#define strcpy_s(d,l,s) strcpy(d,s)</span></div>
<div class="line"><span class="preprocessor">#define strcat_s(d,l,s) strcat(d,s)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if ! defined(_MSC_VER)</span></div>
<div class="line"><span class="preprocessor">#include &lt;dirent.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/param.h&gt;</span></div>
<div class="line"><span class="preprocessor">#define  stricmp strcasecmp</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef _MAX_PATH</span></div>
<div class="line"><span class="preprocessor">#define _MAX_PATH 1024</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// prototypes</span></div>
<div class="line"><span class="keyword">class </span>Options;</div>
<div class="line"><span class="keywordtype">int</span> getFileType(<span class="keyword">const</span> <span class="keywordtype">char</span>* path ,Options&amp; options);</div>
<div class="line"><span class="keywordtype">int</span> getFileType(std::string&amp; path,Options&amp; options);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">string</span> getExifTime(<span class="keyword">const</span> time_t t);</div>
<div class="line">time_t parseTime(<span class="keyword">const</span> <span class="keywordtype">char</span>* ,<span class="keywordtype">bool</span> bAdjust=<span class="keyword">false</span>);</div>
<div class="line"><span class="keywordtype">int</span>    timeZoneAdjust();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// platform specific code</span></div>
<div class="line"><span class="preprocessor">#if defined(_MSC_VER) || defined(__MINGW__)</span></div>
<div class="line"><span class="keywordtype">char</span>* realpath(<span class="keyword">const</span> <span class="keywordtype">char</span>* file,<span class="keywordtype">char</span>* path)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>* result = (<span class="keywordtype">char</span>*) malloc(_MAX_PATH);</div>
<div class="line">    <span class="keywordflow">if</span>   (result) GetFullPathName(file,_MAX_PATH,result,NULL);</div>
<div class="line">    <span class="keywordflow">return</span> result ;</div>
<div class="line">    UNUSED(path);</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Command-line parser</span></div>
<div class="line"><span class="keyword">class </span>Options  {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">bool</span>        verbose;</div>
<div class="line">    <span class="keywordtype">bool</span>        help;</div>
<div class="line">    <span class="keywordtype">bool</span>        <a class="code" href="namespaceExiv2.html#a64705a2301776cea1f4993d9066d44b3">version</a>;</div>
<div class="line">    <span class="keywordtype">bool</span>        dst;</div>
<div class="line">    <span class="keywordtype">bool</span>        dryrun;</div>
<div class="line">    <span class="keywordtype">bool</span>        ascii;</div>
<div class="line"> </div>
<div class="line">    Options()</div>
<div class="line">    {</div>
<div class="line">        verbose     = <span class="keyword">false</span>;</div>
<div class="line">        help        = <span class="keyword">false</span>;</div>
<div class="line">        <a class="code" href="namespaceExiv2.html#a64705a2301776cea1f4993d9066d44b3">version</a>     = <span class="keyword">false</span>;</div>
<div class="line">        dst         = <span class="keyword">false</span>;</div>
<div class="line">        dryrun      = <span class="keyword">false</span>;</div>
<div class="line">        ascii       = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~Options() {} ;</div>
<div class="line">} ;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span></div>
<div class="line">{   resultOK=0</div>
<div class="line">,   resultSyntaxError</div>
<div class="line">,   resultSelectFailed</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span>                        <span class="comment">// keyword indices</span></div>
<div class="line">{   kwHELP = 0</div>
<div class="line">,   kwVERSION</div>
<div class="line">,   kwDST</div>
<div class="line">,   kwDRYRUN</div>
<div class="line">,   kwASCII</div>
<div class="line">,   kwVERBOSE</div>
<div class="line">,   kwADJUST</div>
<div class="line">,   kwTZ</div>
<div class="line">,   kwDELTA</div>
<div class="line">,   kwMAX                   <span class="comment">// manages keyword array</span></div>
<div class="line">,   kwNEEDVALUE             <span class="comment">// bogus keywords for error reporting</span></div>
<div class="line">,   kwSYNTAX                <span class="comment">// -- ditto --</span></div>
<div class="line">,   kwNOVALUE = -kwVERBOSE  <span class="comment">// keywords &lt;= kwNOVALUE are flags (no value needed)</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// file types supported</span></div>
<div class="line"><span class="keyword">enum</span></div>
<div class="line">{   typeUnknown   = 0</div>
<div class="line">,   typeDirectory = 1</div>
<div class="line">,   typeImage     = 2</div>
<div class="line">,   typeXML       = 3</div>
<div class="line">,   typeFile      = 4</div>
<div class="line">,   typeDoc       = 5</div>
<div class="line">,   typeCode      = 6</div>
<div class="line">,   typeMax       = 7</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// forward declaration</span></div>
<div class="line"><span class="keyword">class </span>Position;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// globals</span></div>
<div class="line"><span class="keyword">typedef</span> std::map&lt;time_t,Position&gt;           TimeDict_t;</div>
<div class="line"><span class="keyword">typedef</span> std::map&lt;time_t,Position&gt;::iterator TimeDict_i;</div>
<div class="line"><span class="keyword">typedef</span> std::vector&lt;std::string&gt;            strings_t;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>*  gDeg = NULL ; <span class="comment">// string &quot;Â°&quot; or &quot;deg&quot;</span></div>
<div class="line">TimeDict_t   gTimeDict   ;</div>
<div class="line">strings_t    gFiles;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Position (from gpx file)</span></div>
<div class="line"><span class="keyword">class </span>Position</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Position(time_t time, <span class="keywordtype">double</span> lat, <span class="keywordtype">double</span> lon, <span class="keywordtype">double</span> ele) :</div>
<div class="line">        time_(<a class="code" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>)</div>
<div class="line">      , lon_(lon)</div>
<div class="line">      , lat_(lat)</div>
<div class="line">      , ele_(ele)</div>
<div class="line">      , delta_(0)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    Position():</div>
<div class="line">        time_(0)</div>
<div class="line">      , lon_(0.0)</div>
<div class="line">      , lat_(0.0)</div>
<div class="line">      , ele_(0.0)</div>
<div class="line">      , delta_(0)</div>
<div class="line">    { }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> ~Position() {}</div>
<div class="line"><span class="comment">//  copy constructor</span></div>
<div class="line">    Position(<span class="keyword">const</span> Position&amp; o) :</div>
<div class="line">        time_(o.time_)</div>
<div class="line">      , lon_(o.lon_)</div>
<div class="line">      , lat_(o.lat_)</div>
<div class="line">      , ele_(o.ele_)</div>
<div class="line">      , delta_(o.delta_)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  instance methods</span></div>
<div class="line">    <span class="keywordtype">bool</span> good()                 { <span class="keywordflow">return</span> time_ || lon_ || lat_ || ele_ ; }</div>
<div class="line">    std::string getTimeString() { <span class="keywordflow">if</span> ( times_.empty() ) times_ = getExifTime(time_) ;  <span class="keywordflow">return</span> times_; }</div>
<div class="line">    time_t      getTime()       { <span class="keywordflow">return</span> time_ ; }</div>
<div class="line">    std::string <a class="code" href="namespaceExiv2.html#aeb5a1b7e0a14e8671707d5be16cbda24">toString</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  getters/setters</span></div>
<div class="line">    <span class="keywordtype">double</span> lat()            {<span class="keywordflow">return</span> lat_   ;}</div>
<div class="line">    <span class="keywordtype">double</span> lon()            {<span class="keywordflow">return</span> lon_   ;}</div>
<div class="line">    <span class="keywordtype">double</span> ele()            {<span class="keywordflow">return</span> ele_   ;}</div>
<div class="line">    <span class="keywordtype">int</span>    delta()          {<span class="keywordflow">return</span> delta_ ;}</div>
<div class="line">    <span class="keywordtype">void</span>   delta(<span class="keywordtype">int</span> delta) {delta_=delta  ;}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  data</span></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    time_t      time_;</div>
<div class="line">    <span class="keywordtype">double</span>      lon_ ;</div>
<div class="line">    <span class="keywordtype">double</span>      lat_ ;</div>
<div class="line">    <span class="keywordtype">double</span>      ele_ ;</div>
<div class="line">    std::string times_;</div>
<div class="line">    <span class="keywordtype">int</span>         delta_;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// public static data</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    adjust_  ;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    tz_      ;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    dst_     ;</div>
<div class="line">    <span class="keyword">static</span> time_t deltaMax_;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// public static member functions</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    Adjust() {<span class="keywordflow">return</span> Position::adjust_ + Position::tz_ + Position::dst_ ;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    tz()     {<span class="keywordflow">return</span> tz_    ;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    dst()    {<span class="keywordflow">return</span> dst_   ;}</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span>    adjust() {<span class="keywordflow">return</span> adjust_;}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::string toExifString(<span class="keywordtype">double</span> d,<span class="keywordtype">bool</span> bRational,<span class="keywordtype">bool</span> bLat);</div>
<div class="line">    <span class="keyword">static</span> std::string toExifString(<span class="keywordtype">double</span> d);</div>
<div class="line">    <span class="keyword">static</span> std::string toExifTimeStamp(std::string&amp; t);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifTimeStamp(std::string&amp; t)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>        result[200];</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* arg = t.c_str();</div>
<div class="line">    <span class="keywordtype">int</span> HH = 0 ;</div>
<div class="line">    <span class="keywordtype">int</span> mm = 0 ;</div>
<div class="line">    <span class="keywordtype">int</span> SS1 = 0 ;</div>
<div class="line">    <span class="keywordflow">if</span> ( strstr(arg,<span class="stringliteral">&quot;:&quot;</span>) || strstr(arg,<span class="stringliteral">&quot;-&quot;</span>) ) {</div>
<div class="line">        <span class="keywordtype">int</span> YY=0,MM=0,DD=0;</div>
<div class="line">        <span class="keywordtype">char</span> a=0,b=0,c=0,d=0,e=0;</div>
<div class="line">        sscanf(arg,<span class="stringliteral">&quot;%d%c%d%c%d%c%d%c%d%c%d&quot;</span>,&amp;YY,&amp;a,&amp;MM,&amp;b,&amp;DD,&amp;c,&amp;HH,&amp;d,&amp;mm,&amp;e,&amp;SS1);</div>
<div class="line">    }</div>
<div class="line">    sprintf(result,<span class="stringliteral">&quot;%d/1 %d/1 %d/1&quot;</span>,HH,mm,SS1);</div>
<div class="line">    <span class="keywordflow">return</span> std::string(result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifString(<span class="keywordtype">double</span> d)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> result[200];</div>
<div class="line">    d *= 100;</div>
<div class="line">    sprintf(result,<span class="stringliteral">&quot;%d/100&quot;</span>,abs((<span class="keywordtype">int</span>)d));</div>
<div class="line">    <span class="keywordflow">return</span> std::string(result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toExifString(<span class="keywordtype">double</span> d,<span class="keywordtype">bool</span> bRational,<span class="keywordtype">bool</span> bLat)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* NS   = d&gt;=0.0?<span class="stringliteral">&quot;N&quot;</span>:<span class="stringliteral">&quot;S&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* EW   = d&gt;=0.0?<span class="stringliteral">&quot;E&quot;</span>:<span class="stringliteral">&quot;W&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* NSEW = bLat  ? NS: EW;</div>
<div class="line">    <span class="keywordflow">if</span> ( d &lt; 0 ) d = -d;</div>
<div class="line">    <span class="keywordtype">int</span> deg = (int) d;</div>
<div class="line">        d  -= deg;</div>
<div class="line">        d  *= 60;</div>
<div class="line">    <span class="keywordtype">int</span> min = (int) d ;</div>
<div class="line">        d  -= min;</div>
<div class="line">        d  *= 60;</div>
<div class="line">    <span class="keywordtype">int</span> sec = (int)d;</div>
<div class="line">    <span class="keywordtype">char</span> result[200];</div>
<div class="line">    <span class="keywordflow">if</span> ( bRational )</div>
<div class="line">        sprintf(result,<span class="stringliteral">&quot;%d/1 %d/1 %d/1&quot;</span> ,deg,min,sec);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        sprintf(result,<span class="stringliteral">&quot;%03d%s%02d&#39;%02d\&quot;%s&quot;</span> ,deg,gDeg,min,sec,NSEW);</div>
<div class="line">    <span class="keywordflow">return</span> std::string(result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string Position::toString()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> result[200];</div>
<div class="line">    std::string sLat = Position::toExifString(lat_,<span class="keyword">false</span>,<span class="keyword">true</span> );</div>
<div class="line">    std::string sLon = Position::toExifString(lon_,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line">    sprintf(result,<span class="stringliteral">&quot;%s %s %-8.3f&quot;</span>,sLon.c_str(),sLat.c_str(),ele_);</div>
<div class="line">    <span class="keywordflow">return</span> std::string(result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// defaults</span></div>
<div class="line"><span class="keywordtype">int</span>    Position::adjust_   = 0;</div>
<div class="line"><span class="keywordtype">int</span>    Position::tz_       = timeZoneAdjust();</div>
<div class="line"><span class="keywordtype">int</span>    Position::dst_      = 0;</div>
<div class="line">time_t Position::deltaMax_ = 60 ;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// UserData - used by XML Parser</span></div>
<div class="line"><span class="keyword">class </span>UserData</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> UserData(Options&amp; options):</div>
<div class="line">        indent(0)</div>
<div class="line">      , count(0)</div>
<div class="line">      , nTrkpt(0)</div>
<div class="line">      , bTime(false)</div>
<div class="line">      , bEle(false)</div>
<div class="line">      , ele(0.0)</div>
<div class="line">      , lat(0.0)</div>
<div class="line">      , lon(0.0)</div>
<div class="line">      , options_(options)</div>
<div class="line">    {}</div>
<div class="line">    <span class="keyword">virtual</span> ~UserData() {}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  public data members</span></div>
<div class="line">    <span class="keywordtype">int</span>         indent;</div>
<div class="line">    <span class="keywordtype">size_t</span>      count ;</div>
<div class="line">    Position    now ;</div>
<div class="line">    Position    prev;</div>
<div class="line">    <span class="keywordtype">int</span>         nTrkpt;</div>
<div class="line">    <span class="keywordtype">bool</span>        bTime ;</div>
<div class="line">    <span class="keywordtype">bool</span>        bEle  ;</div>
<div class="line">    <span class="keywordtype">double</span>      ele;</div>
<div class="line">    <span class="keywordtype">double</span>      lat;</div>
<div class="line">    <span class="keywordtype">double</span>      lon;</div>
<div class="line">    std::string xmlt;</div>
<div class="line">    std::string exift;</div>
<div class="line">    time_t      <a class="code" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>;</div>
<div class="line">    Options&amp;    options_;</div>
<div class="line"><span class="comment">// static public data memembers</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// XML Parser Callbacks</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> startElement(<span class="keywordtype">void</span>* userData, <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <span class="keywordtype">char</span>** atts )</div>
<div class="line">{</div>
<div class="line">    UserData* me = (UserData*) userData;</div>
<div class="line">    <span class="comment">//for ( int i = 0 ; i &lt; me-&gt;indent ; i++ ) printf(&quot; &quot;);</span></div>
<div class="line">    <span class="comment">//printf(&quot;begin %s\n&quot;,name);</span></div>
<div class="line">    me-&gt;bTime = strcmp(name,<span class="stringliteral">&quot;time&quot;</span>)==0;</div>
<div class="line">    me-&gt;bEle  = strcmp(name,<span class="stringliteral">&quot;ele&quot;</span>)==0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( strcmp(name,<span class="stringliteral">&quot;trkpt&quot;</span>)==0 ) {</div>
<div class="line">        me-&gt;nTrkpt++;</div>
<div class="line">        <span class="keywordflow">while</span> ( *atts ) {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* a=atts[0];</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* v=atts[1];</div>
<div class="line">            <span class="keywordflow">if</span> ( !strcmp(a,<span class="stringliteral">&quot;lat&quot;</span>) ) me-&gt;lat = atof(v);</div>
<div class="line">            <span class="keywordflow">if</span> ( !strcmp(a,<span class="stringliteral">&quot;lon&quot;</span>) ) me-&gt;lon = atof(v);</div>
<div class="line">            atts += 2 ;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    me-&gt;count++  ;</div>
<div class="line">    me-&gt;indent++ ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> endElement(<span class="keywordtype">void</span>* userData, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line">{</div>
<div class="line">    UserData* me = (UserData*) userData;</div>
<div class="line">    me-&gt;indent-- ;</div>
<div class="line">    <span class="keywordflow">if</span> ( strcmp(name,<span class="stringliteral">&quot;trkpt&quot;</span>)==0 ) {</div>
<div class="line"> </div>
<div class="line">        me-&gt;nTrkpt--;</div>
<div class="line">        me-&gt;now = Position(me-&gt;time,me-&gt;lat,me-&gt;lon,me-&gt;ele) ;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ( !me-&gt;prev.good() &amp;&amp; me-&gt;options_.verbose ) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;trkseg %s begin &quot;</span>,me-&gt;now.getTimeString().c_str());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// remember our location and put it in gTimeDict</span></div>
<div class="line">        gTimeDict[me-&gt;time] = me-&gt;now ;</div>
<div class="line">        me-&gt;prev = me-&gt;now ;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ( strcmp(name,<span class="stringliteral">&quot;trkseg&quot;</span>)==0 &amp;&amp; me-&gt;options_.verbose ) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s end\n&quot;</span>,me-&gt;now.getTimeString().c_str());</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> charHandler(<span class="keywordtype">void</span>* userData,<span class="keyword">const</span> <span class="keywordtype">char</span>* s,<span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">    UserData* me = (UserData*) userData;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( me-&gt;nTrkpt == 1 ) {</div>
<div class="line">        <span class="keywordtype">char</span> buffer[100];</div>
<div class="line">        <span class="keywordtype">int</span>  l_max = 98 ; <span class="comment">// lengthof(buffer) -2 ;</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ( me-&gt;bTime &amp;&amp; len &gt; 5 ) {</div>
<div class="line">            <span class="keywordflow">if</span> ( len &lt; l_max ) {</div>
<div class="line">                memcpy(buffer,s,len);</div>
<div class="line">                buffer[len]=0;</div>
<div class="line">                <span class="keywordtype">char</span>* b = buffer ;</div>
<div class="line">                <span class="keywordflow">while</span> ( *b == <span class="charliteral">&#39; &#39;</span> &amp;&amp; b &lt; buffer+len ) b++ ;</div>
<div class="line">                me-&gt;xmlt  = b ;</div>
<div class="line">                me-&gt;time  = parseTime(me-&gt;xmlt.c_str());</div>
<div class="line">                me-&gt;exift = getExifTime(me-&gt;time);</div>
<div class="line">            }</div>
<div class="line">            me-&gt;bTime=<span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ( me-&gt;bEle &amp;&amp; len &gt; 2 ) {</div>
<div class="line">            <span class="keywordflow">if</span> ( len &lt; l_max ) {</div>
<div class="line">                memcpy(buffer,s,len);</div>
<div class="line">                buffer[len]=0;</div>
<div class="line">                <span class="keywordtype">char</span>* b = buffer ;</div>
<div class="line">                <span class="keywordflow">while</span> ( *b == <span class="charliteral">&#39; &#39;</span> &amp;&amp; b &lt; buffer+len ) b++ ;</div>
<div class="line">                me-&gt;ele = atof(b);</div>
<div class="line">            }</div>
<div class="line">            me-&gt;bEle=<span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Time Functions</span></div>
<div class="line">time_t parseTime(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg,<span class="keywordtype">bool</span> bAdjust)</div>
<div class="line">{</div>
<div class="line">    time_t result = 0 ;</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="comment">//559 rmills@rmills-imac:~/bin $ exiv2 -pa ~/R.jpg | grep -i date</span></div>
<div class="line">        <span class="comment">//Exif.Image.DateTime                          Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">        <span class="comment">//Exif.Photo.DateTimeOriginal                  Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">        <span class="comment">//Exif.Photo.DateTimeDigitized                 Ascii      20  2009:08:03 08:58:57</span></div>
<div class="line">        <span class="comment">//Exif.GPSInfo.GPSDateStamp                    Ascii      21  2009-08-03T15:58:57Z</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// &lt;time&gt;2012-07-14T17:33:16Z&lt;/time&gt;</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ( strstr(arg,<span class="stringliteral">&quot;:&quot;</span>) || strstr(arg,<span class="stringliteral">&quot;-&quot;</span>) ) {</div>
<div class="line">            <span class="keywordtype">int</span>  YY=0,MM=0,DD=0,HH=0,mm=0,SS1=0;</div>
<div class="line">            <span class="keywordtype">char</span> a=0,b=0,c=0,d=0,e=0;</div>
<div class="line">            sscanf(arg,<span class="stringliteral">&quot;%d%c%d%c%d%c%d%c%d%c%d&quot;</span>,&amp;YY,&amp;a,&amp;MM,&amp;b,&amp;DD,&amp;c,&amp;HH,&amp;d,&amp;mm,&amp;e,&amp;SS1);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">struct </span>tm T;</div>
<div class="line">            memset(&amp;T,0,<span class="keyword">sizeof</span>(T));</div>
<div class="line">            T.tm_min  = mm  ;</div>
<div class="line">            T.tm_hour = HH  ;</div>
<div class="line">            T.tm_sec  = SS1 ;</div>
<div class="line">            <span class="keywordflow">if</span> ( bAdjust ) T.tm_sec -= Position::Adjust();</div>
<div class="line">            T.tm_year = YY -1900 ;</div>
<div class="line">            T.tm_mon  = MM -1    ;</div>
<div class="line">            T.tm_mday = DD  ;</div>
<div class="line">            T.tm_isdst = -1 ; <span class="comment">// determine value automatically (otherwise hour may shift)</span></div>
<div class="line">            result = mktime(&amp;T);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">catch</span> ( ... ) {};</div>
<div class="line">    <span class="keywordflow">return</span> result ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// West of GMT is negative (PDT = Pacific Daylight = -07:00 == -25200 seconds</span></div>
<div class="line"><span class="keywordtype">int</span> timeZoneAdjust()</div>
<div class="line">{</div>
<div class="line">    time_t    now   = <a class="code" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>(NULL);</div>
<div class="line">    <span class="keywordtype">int</span>       offset;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if   defined(_MSC_VER) || defined(__MINGW__)</span></div>
<div class="line">    TIME_ZONE_INFORMATION TimeZoneInfo;</div>
<div class="line">    GetTimeZoneInformation( &amp;TimeZoneInfo );</div>
<div class="line">    offset = - (((int)TimeZoneInfo.Bias + (<span class="keywordtype">int</span>)TimeZoneInfo.DaylightBias) * 60);</div>
<div class="line">    UNUSED(now);</div>
<div class="line"><span class="preprocessor">#elif defined(__CYGWIN__)</span></div>
<div class="line">    <span class="keyword">struct </span>tm lcopy = *localtime(&amp;now);</div>
<div class="line">    time_t    gmt   =  timegm(&amp;lcopy) ; <span class="comment">// timegm modifies lcopy</span></div>
<div class="line">    offset          = (int) ( ((<span class="keywordtype">long</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span>) gmt) - ((<span class="keywordtype">long</span> <span class="keywordtype">signed</span> int) now) ) ;</div>
<div class="line"><span class="preprocessor">#elif defined(OS_SOLARIS) || defined(__sun__)</span></div>
<div class="line">    <span class="keyword">struct </span>tm local = *localtime(&amp;now) ;</div>
<div class="line">    time_t local_tt = (int) mktime(&amp;local);</div>
<div class="line">    time_t time_gmt = (int) mktime(gmtime(&amp;now));</div>
<div class="line">    offset          = time_gmt - local_tt;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keyword">struct </span>tm local = *localtime(&amp;now) ;</div>
<div class="line">    offset          = local.tm_gmtoff ;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if EXIV2_DEBUG_MESSAGES</span></div>
<div class="line">    <span class="keyword">struct </span>tm utc = *gmtime(&amp;now);</div>
<div class="line">    printf(<span class="stringliteral">&quot;utc  :  offset = %6d dst = %d time = %s&quot;</span>, 0     ,utc  .tm_isdst, asctime(&amp;utc  ));</div>
<div class="line">    printf(<span class="stringliteral">&quot;local:  offset = %6d dst = %d time = %s&quot;</span>, offset,local.tm_isdst, asctime(&amp;local));</div>
<div class="line">    printf(<span class="stringliteral">&quot;timeZoneAdjust = %6d\n&quot;</span>,offset);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> offset ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">string</span> getExifTime(<span class="keyword">const</span> time_t t)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> result[100];</div>
<div class="line">    strftime(result,<span class="keyword">sizeof</span>(result),<span class="stringliteral">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,localtime(&amp;t));</div>
<div class="line">    <span class="keywordflow">return</span> result ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::string makePath(<span class="keyword">const</span> std::string&amp; dir, <span class="keyword">const</span> std::string&amp; file)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> dir + std::string(EXV_SEPARATOR_STR) + file ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* makePath(<span class="keyword">const</span> <span class="keywordtype">char</span>* dir,<span class="keyword">const</span> <span class="keywordtype">char</span>* file)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> result[_MAX_PATH] ;</div>
<div class="line">    std::string r = makePath(std::string(dir),std::string(file));</div>
<div class="line">    strcpy(result,r.c_str());</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// file utilities</span></div>
<div class="line"><span class="keywordtype">bool</span> readDir(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,Options&amp; options)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> bResult = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line">    DWORD attrs    =  GetFileAttributes(path);</div>
<div class="line">    <span class="keywordtype">bool</span>  bOKAttrs =  attrs != INVALID_FILE_ATTRIBUTES;</div>
<div class="line">    <span class="keywordtype">bool</span>  bIsDir   = (attrs  &amp; FILE_ATTRIBUTE_DIRECTORY) ? <span class="keyword">true</span> : <span class="keyword">false</span> ;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( bOKAttrs &amp;&amp; bIsDir ) {</div>
<div class="line">        bResult = true ;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">char</span>     search[_MAX_PATH+10];</div>
<div class="line">        strcpy_s(search,_MAX_PATH,path);</div>
<div class="line">        strcat_s(search,_MAX_PATH,<span class="stringliteral">&quot;\\*&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        WIN32_FIND_DATA ffd;</div>
<div class="line">        HANDLE  hFind = FindFirstFile(search, &amp;ffd);</div>
<div class="line">        BOOL    bGo = hFind != INVALID_HANDLE_VALUE;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ( bGo ) {</div>
<div class="line">            <span class="keywordflow">while</span> ( bGo ) {</div>
<div class="line">                <span class="keywordflow">if</span> (ffd.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// _tprintf(TEXT(&quot;  %s   &lt;DIR&gt;\n&quot;), ffd.cFileName);</span></div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    std::string pathName = makePath(path,std::string(ffd.cFileName));</div>
<div class="line">                    <span class="keywordflow">if</span> ( getFileType(pathName,options) == typeImage ) {</div>
<div class="line">                        gFiles.push_back( pathName );</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                bGo = FindNextFile(hFind, &amp;ffd) != 0;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// CloseHandle(hFind);</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    DIR*    dir = opendir (path);</div>
<div class="line">    <span class="keywordflow">if</span> (dir != NULL)</div>
<div class="line">    {</div>
<div class="line">        bResult = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keyword">struct </span>dirent*  ent;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// print all the files and directories within directory</span></div>
<div class="line">        <span class="keywordflow">while</span> ((ent = readdir (dir)) != NULL)</div>
<div class="line">        {</div>
<div class="line">            std::string pathName = makePath(path,ent-&gt;d_name);</div>
<div class="line">            <span class="keyword">struct </span>stat  buf     ;</div>
<div class="line">            lstat(path, &amp;buf );</div>
<div class="line">            <span class="keywordflow">if</span> ( ent-&gt;d_name[0] != <span class="charliteral">&#39;.&#39;</span> ) {</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// printf(&quot;reading %s =&gt; %s\n&quot;,ent-&gt;d_name,pathName.c_str());</span></div>
<div class="line">                <span class="keywordflow">if</span> ( getFileType(pathName,options) == typeImage ) {</div>
<div class="line">                    gFiles.push_back( pathName );</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        closedir (dir);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">return</span> bResult ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> sip(FILE* f,<span class="keywordtype">char</span>* buffer,<span class="keywordtype">size_t</span> max_len,<span class="keywordtype">size_t</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> ( !feof(f) &amp;&amp; len &lt; max_len &amp;&amp; buffer[len-1] != <span class="charliteral">&#39;&gt;&#39;</span>)</div>
<div class="line">        buffer[len++] = fgetc(f);</div>
<div class="line">    <span class="keywordflow">return</span> len;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> readXML(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,Options&amp; options)</div>
<div class="line">{</div>
<div class="line">    FILE*       f       = fopen(path,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    XML_Parser  parser  = XML_ParserCreate(NULL);</div>
<div class="line">    <span class="keywordtype">bool</span> bResult        = f &amp;&amp; parser ;</div>
<div class="line">    <span class="keywordflow">if</span> ( bResult ) {</div>
<div class="line">        <span class="keywordtype">char</span>   buffer[8*1024];</div>
<div class="line">        UserData me(options) ;</div>
<div class="line"> </div>
<div class="line">        XML_SetUserData            (parser, &amp;me);</div>
<div class="line">        XML_SetElementHandler      (parser, startElement, endElement);</div>
<div class="line">        XML_SetCharacterDataHandler(parser,charHandler);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// a little sip at the data</span></div>
<div class="line">        <span class="keywordtype">size_t</span> len = fread(buffer,1,<span class="keyword">sizeof</span>(buffer)-100,f);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* lead   = <span class="stringliteral">&quot;&lt;?xml&quot;</span> ;</div>
<div class="line">        bResult = strncmp(lead,buffer,strlen(lead))==0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// swallow it</span></div>
<div class="line">        <span class="keywordflow">if</span> ( bResult ) {</div>
<div class="line">            len = sip(f,buffer,<span class="keyword">sizeof</span> buffer,len);</div>
<div class="line">            bResult = XML_Parse(parser, buffer,(<span class="keywordtype">int</span>)len, len == 0 ) == XML_STATUS_OK;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// drink the rest of the file</span></div>
<div class="line">        <span class="keywordflow">while</span> ( bResult &amp;&amp; len != 0 ) {</div>
<div class="line">            len = fread(buffer,1,<span class="keyword">sizeof</span>(buffer)-100,f);</div>
<div class="line">            len = sip(f,buffer,<span class="keyword">sizeof</span> buffer,len);</div>
<div class="line">            bResult = XML_Parse(parser, buffer,(<span class="keywordtype">int</span>)len, len == 0 ) == XML_STATUS_OK;</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( f      ) fclose(f);</div>
<div class="line">    <span class="keywordflow">if</span> ( parser ) XML_ParserFree(parser);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bResult ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> readImage(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,Options&amp; <span class="comment">/* options */</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="namespaceExiv2.html">Exiv2</a>;</div>
<div class="line">    <span class="keywordtype">bool</span> bResult = false ;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code" href="classExiv2_1_1Image.html#a89ad3ffe7a4e8a943d267d77843415fb">Image::AutoPtr</a> image = ImageFactory::open(path);</div>
<div class="line">        <span class="keywordflow">if</span> ( image.get() ) {</div>
<div class="line">            image-&gt;readMetadata();</div>
<div class="line">            <a name="_a0"></a><a class="code" href="classExiv2_1_1ExifData.html">ExifData</a> &amp;exifData = image-&gt;exifData();</div>
<div class="line">            bResult = !exifData.<a name="a1"></a><a class="code" href="classExiv2_1_1ExifData.html#a0627816364585c0579cba89e6e287d74">empty</a>();</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">catch</span> ( ... ) {};</div>
<div class="line">    <span class="keywordflow">return</span> bResult ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">time_t readImageTime(<span class="keyword">const</span> std::string&amp; path,std::string* pS=NULL)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="namespaceExiv2.html">Exiv2</a>;</div>
<div class="line"> </div>
<div class="line">    time_t       result       = 0 ;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* dateStrings[] =</div>
<div class="line">    { <span class="stringliteral">&quot;Exif.Photo.DateTimeOriginal&quot;</span></div>
<div class="line">    , <span class="stringliteral">&quot;Exif.Photo.DateTimeDigitized&quot;</span></div>
<div class="line">    , <span class="stringliteral">&quot;Exif.Image.DateTime&quot;</span></div>
<div class="line">    , NULL</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* dateString = dateStrings[0] ;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">            <a class="code" href="classExiv2_1_1Image.html#a89ad3ffe7a4e8a943d267d77843415fb">Image::AutoPtr</a> image = ImageFactory::open(path);</div>
<div class="line">            <span class="keywordflow">if</span> ( image.get() ) {</div>
<div class="line">                image-&gt;readMetadata();</div>
<div class="line">                <a class="code" href="classExiv2_1_1ExifData.html">ExifData</a> &amp;exifData = image-&gt;exifData();</div>
<div class="line">            <span class="comment">//  printf(&quot;%s =&gt; %s\n&quot;,dateString, exifData[dateString].toString().c_str());</span></div>
<div class="line">                result = parseTime(exifData[dateString].<a class="code" href="namespaceExiv2.html#aeb5a1b7e0a14e8671707d5be16cbda24">toString</a>().c_str(),<span class="keyword">true</span>);</div>
<div class="line">                <span class="keywordflow">if</span> ( result &amp;&amp; pS ) *pS = exifData[dateString].toString();</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">catch</span> ( ... ) {};</div>
<div class="line">    } <span class="keywordflow">while</span> ( !result &amp;&amp; ++dateString );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> sina(<span class="keyword">const</span> <span class="keywordtype">char</span>* s,<span class="keyword">const</span> <span class="keywordtype">char</span>** a)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> bResult = false ;</div>
<div class="line">    <span class="keywordtype">int</span> i = 0 ;</div>
<div class="line">    <span class="keywordflow">while</span> ( *s == <span class="charliteral">&#39;-&#39;</span> ) s++;</div>
<div class="line">    <span class="keywordflow">while</span> ( !bResult &amp;&amp; a[i]) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* A = a[i] ;</div>
<div class="line">        <span class="keywordflow">while</span> ( *A == <span class="charliteral">&#39;-&#39;</span> ) A++ ;</div>
<div class="line">        bResult = stricmp(s,A)==0;</div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> bResult;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="namespaceExiv2.html#a5c87ddedd63e9ab9aa6f295cda32aebd">readFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,Options <span class="comment">/* options */</span>)</div>
<div class="line">{</div>
<div class="line">    FILE* f     = fopen(path,<span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> nResult = f ? typeFile : typeUnknown;</div>
<div class="line">    <span class="keywordflow">if</span> (  f ) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>*  ext   = strstr(path,<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span>  ( ext ) {</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* docs[] = { <span class="stringliteral">&quot;.doc&quot;</span>,<span class="stringliteral">&quot;.txt&quot;</span>, NULL };</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* code[] = { <span class="stringliteral">&quot;.cpp&quot;</span>,<span class="stringliteral">&quot;.h&quot;</span>  ,<span class="stringliteral">&quot;.pl&quot;</span> ,<span class="stringliteral">&quot;.py&quot;</span> ,<span class="stringliteral">&quot;.pyc&quot;</span>, NULL };</div>
<div class="line">            <span class="keywordflow">if</span> ( sina(ext,docs) )</div>
<div class="line">                nResult = typeDoc;</div>
<div class="line">            <span class="keywordflow">if</span> ( sina(ext,code) )</div>
<div class="line">                nResult = typeCode;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> ( f ) fclose(f) ;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> nResult ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Position* searchTimeDict(TimeDict_t&amp; td, <span class="keyword">const</span> time_t&amp; time,<span class="keywordtype">long</span> <span class="keywordtype">long</span> delta)</div>
<div class="line">{</div>
<div class="line">    Position* result = NULL;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> t = 0 ; !result &amp;&amp; t &lt; delta ; t++ ) {</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> x = 0 ; !result &amp;&amp; x &lt; 2 ; x++ ) {</div>
<div class="line">            <span class="keywordtype">int</span> T = t * ((x==0)?-1:1);</div>
<div class="line">            <span class="keywordflow">if</span> ( td.count(time+T) ) {</div>
<div class="line">                result = &amp;td[<a class="code" href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">time</a>+T];</div>
<div class="line">                result-&gt;delta(T);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> getFileType(std::string&amp; path,Options&amp; options) { <span class="keywordflow">return</span> getFileType(path.c_str(),options); }</div>
<div class="line"><span class="keywordtype">int</span> getFileType(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,Options&amp; options)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> readXML  (path,options) ? typeXML</div>
<div class="line">        :  readDir  (path,options) ? typeDirectory</div>
<div class="line">        :  readImage(path,options) ? typeImage</div>
<div class="line">        :  <a class="code" href="namespaceExiv2.html#a5c87ddedd63e9ab9aa6f295cda32aebd">readFile</a> (path,options)</div>
<div class="line">        ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="namespaceExiv2.html#a64705a2301776cea1f4993d9066d44b3">version</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s: %s %s\n&quot;</span>,program,__DATE__,__TIME__);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> help(<span class="keyword">const</span> <span class="keywordtype">char</span>* program,<span class="keywordtype">char</span> <span class="keyword">const</span>* words[],<span class="keywordtype">int</span> nWords,<span class="keywordtype">bool</span> <span class="comment">/*bVerbose*/</span>)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;usage: %s &quot;</span>,program);</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0 ; i &lt; nWords ; i++ ) {</div>
<div class="line">        <span class="keywordflow">if</span> ( words[i] )</div>
<div class="line">            printf(<span class="stringliteral">&quot;%c-%s%s&quot;</span>,i?<span class="charliteral">&#39;|&#39;</span>:<span class="charliteral">&#39;{&#39;</span>,words[i],i&gt;(-kwNOVALUE)?<span class="stringliteral">&quot; value&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;}+ path+\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> compare(<span class="keyword">const</span> <span class="keywordtype">char</span>* a,<span class="keyword">const</span> <span class="keywordtype">char</span>* b)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> result=*a &amp;&amp; *b;</div>
<div class="line">    <span class="keywordflow">while</span> ( result &amp;&amp; *a &amp;&amp; *b) {</div>
<div class="line">        <span class="keywordtype">char</span> A=*a++;</div>
<div class="line">        <span class="keywordtype">char</span> B=*b++;</div>
<div class="line">        result=tolower(A)==tolower(B);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="namespaceExiv2.html#aea35ee7a596e1d47d1ffbb553cfb688d">find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* arg,<span class="keywordtype">char</span> <span class="keyword">const</span>* words[],<span class="keywordtype">int</span> nWords)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ( arg[0] != <span class="charliteral">&#39;-&#39;</span> ) <span class="keywordflow">return</span> kwSYNTAX;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> result=0;</div>
<div class="line">    <span class="keywordtype">int</span> count =0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0 ; i &lt; nWords ; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> j = 0 ;</div>
<div class="line">        <span class="keywordflow">while</span> ( arg[j] == <span class="charliteral">&#39;-&#39;</span> ) j++;</div>
<div class="line">        <span class="keywordflow">if</span> ( ::compare(arg+j,words[i]) ) {</div>
<div class="line">            result = i ;</div>
<div class="line">            count++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> count==1?result:kwSYNTAX;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> parseTZ(<span class="keyword">const</span> <span class="keywordtype">char</span>* adjust)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span>   h=0;</div>
<div class="line">    <span class="keywordtype">int</span>   m=0;</div>
<div class="line">    <span class="keywordtype">char</span>  c=0;</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        sscanf(adjust,<span class="stringliteral">&quot;%d%c%d&quot;</span>,&amp;h,&amp;c,&amp;m);</div>
<div class="line">    } <span class="keywordflow">catch</span> ( ... ) {} ;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (3600*h)+(60*m);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> mySort(<span class="keyword">const</span> std::string&amp; a, <span class="keyword">const</span> std::string&amp; b)</div>
<div class="line">{</div>
<div class="line">    time_t A = readImageTime(a);</div>
<div class="line">    time_t B = readImageTime(b);</div>
<div class="line">    <span class="keywordflow">return</span> (A&lt;B);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,<span class="keyword">const</span> <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a name="a2"></a><a class="code" href="classExiv2_1_1XmpParser.html#aea661a7039adb5a748eb7639c8ce9294">Exiv2::XmpParser::initialize</a>();</div>
<div class="line">    ::atexit(<a name="a3"></a><a class="code" href="classExiv2_1_1XmpParser.html#a46ff7c85b860ef81310e0ac8dd6b62a2">Exiv2::XmpParser::terminate</a>);</div>
<div class="line"><span class="preprocessor">#ifdef EXV_ENABLE_BMFF</span></div>
<div class="line">    Exiv2::enableBMFF();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> result=0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* program = argv[0];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* types[typeMax];</div>
<div class="line">    types[typeUnknown  ] = <span class="stringliteral">&quot;unknown&quot;</span>;</div>
<div class="line">    types[typeDirectory] = <span class="stringliteral">&quot;directory&quot;</span>;</div>
<div class="line">    types[typeImage    ] = <span class="stringliteral">&quot;image&quot;</span>;</div>
<div class="line">    types[typeXML      ] = <span class="stringliteral">&quot;xml&quot;</span>;</div>
<div class="line">    types[typeDoc      ] = <span class="stringliteral">&quot;doc&quot;</span>;</div>
<div class="line">    types[typeCode     ] = <span class="stringliteral">&quot;code&quot;</span>;</div>
<div class="line">    types[typeFile     ] = <span class="stringliteral">&quot;file&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span>* keywords[kwMAX];</div>
<div class="line">    memset(keywords,0,<span class="keyword">sizeof</span>(keywords));</div>
<div class="line">    keywords[kwHELP    ] = <span class="stringliteral">&quot;help&quot;</span>;</div>
<div class="line">    keywords[kwVERSION ] = <span class="stringliteral">&quot;version&quot;</span>;</div>
<div class="line">    keywords[kwVERBOSE ] = <span class="stringliteral">&quot;verbose&quot;</span>;</div>
<div class="line">    keywords[kwDRYRUN  ] = <span class="stringliteral">&quot;dryrun&quot;</span>;</div>
<div class="line">    keywords[kwASCII   ] = <span class="stringliteral">&quot;ascii&quot;</span>;</div>
<div class="line">    keywords[kwDST     ] = <span class="stringliteral">&quot;dst&quot;</span>;</div>
<div class="line">    keywords[kwADJUST  ] = <span class="stringliteral">&quot;adjust&quot;</span>;</div>
<div class="line">    keywords[kwTZ      ] = <span class="stringliteral">&quot;tz&quot;</span>;</div>
<div class="line">    keywords[kwDELTA   ] = <span class="stringliteral">&quot;delta&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    map&lt;std::string,string&gt; shorts;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-?&quot;</span>] = <span class="stringliteral">&quot;-help&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-h&quot;</span>] = <span class="stringliteral">&quot;-help&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-v&quot;</span>] = <span class="stringliteral">&quot;-verbose&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-V&quot;</span>] = <span class="stringliteral">&quot;-version&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-d&quot;</span>] = <span class="stringliteral">&quot;-dst&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-a&quot;</span>] = <span class="stringliteral">&quot;-adjust&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-t&quot;</span>] = <span class="stringliteral">&quot;-tz&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-D&quot;</span>] = <span class="stringliteral">&quot;-delta&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-s&quot;</span>] = <span class="stringliteral">&quot;-delta&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-X&quot;</span>] = <span class="stringliteral">&quot;-dryrun&quot;</span>;</div>
<div class="line">    shorts[<span class="stringliteral">&quot;-a&quot;</span>] = <span class="stringliteral">&quot;-ascii&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    Options options ;</div>
<div class="line">    options.help    = sina(keywords[kwHELP   ],argv) || argc &lt; 2;</div>
<div class="line">    options.verbose = sina(keywords[kwVERBOSE],argv);</div>
<div class="line">    options.dryrun  = sina(keywords[kwDRYRUN ],argv);</div>
<div class="line">    options.version = sina(keywords[kwVERSION],argv);</div>
<div class="line">    options.dst     = sina(keywords[kwDST    ],argv);</div>
<div class="line">    options.ascii   = sina(keywords[kwASCII  ],argv);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1 ; !result &amp;&amp; i &lt; argc ; i++ ) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* arg   = argv[i++];</div>
<div class="line">        <span class="keywordflow">if</span> ( shorts.count(arg) ) arg = shorts[arg].c_str();</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* value = argv[i  ];</div>
<div class="line">        <span class="keywordtype">int</span>        ivalue = ::atoi(value?value:<span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">        <span class="keywordtype">int</span>         key   = ::find(arg,keywords,kwMAX);</div>
<div class="line">        <span class="keywordtype">int</span>         needv = key &lt; kwMAX &amp;&amp; key &gt; (-kwNOVALUE);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!needv ) i--;</div>
<div class="line">        <span class="keywordflow">if</span> ( needv &amp;&amp; !value) key = kwNEEDVALUE;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> ( key ) {</div>
<div class="line">            <span class="keywordflow">case</span> kwDST      : options.dst         = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwHELP     : options.help        = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwVERSION  : options.version     = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwDRYRUN   : options.dryrun      = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwVERBOSE  : options.verbose     = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwASCII    : options.ascii       = true ; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwTZ       : Position::tz_       = parseTZ(value);<span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwADJUST   : Position::adjust_   = ivalue;<span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwDELTA    : Position::deltaMax_ = ivalue;<span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> kwNEEDVALUE: fprintf(stderr,<span class="stringliteral">&quot;error: %s requires a value\n&quot;</span>,arg); result = resultSyntaxError ; break ;</div>
<div class="line">            <span class="keywordflow">case</span> kwSYNTAX   : <span class="keywordflow">default</span>:</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">int</span>  type   = getFileType(arg,options) ;</div>
<div class="line">                <span class="keywordflow">if</span> ( options.verbose ) printf(<span class="stringliteral">&quot;%s %s &quot;</span>,arg,types[type]) ;</div>
<div class="line">                <span class="keywordflow">if</span> ( type == typeImage ) {</div>
<div class="line">                    time_t t    = readImageTime(std::string(arg)) ;</div>
<div class="line"><span class="preprocessor">#ifdef __APPLE__</span></div>
<div class="line">                    <span class="keywordtype">char</span>   buffer[1024];</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">                    <span class="keywordtype">char</span>*  buffer = NULL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">                    <span class="keywordtype">char</span>*  path = realpath(arg,buffer);</div>
<div class="line">                    <span class="keywordflow">if</span>  ( t &amp;&amp; path ) {</div>
<div class="line">                        <span class="keywordflow">if</span> ( options.verbose) printf(<span class="stringliteral">&quot;%s %ld %s&quot;</span>,path,(<span class="keywordtype">long</span> <span class="keywordtype">int</span>)t,asctime(localtime(&amp;t)));</div>
<div class="line">                        gFiles.push_back(path);</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> ( path &amp;&amp; path != buffer ) ::free((<span class="keywordtype">void</span>*) path);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> ( type == typeUnknown ) {</div>
<div class="line">                    fprintf(stderr,<span class="stringliteral">&quot;error: illegal syntax %s\n&quot;</span>,arg);</div>
<div class="line">                    result = resultSyntaxError ;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( options.help    ) ::help(program,keywords,kwMAX,options.verbose);</div>
<div class="line">    <span class="keywordflow">if</span> ( options.version ) ::version(program);</div>
<div class="line">    gDeg = options.ascii ? <span class="stringliteral">&quot;deg&quot;</span> : <span class="stringliteral">&quot;Â°&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( !result ) {</div>
<div class="line">        sort(gFiles.begin(),gFiles.end(),mySort);</div>
<div class="line">        <span class="keywordflow">if</span> ( options.dst ) Position::dst_ = 3600;</div>
<div class="line">        <span class="keywordflow">if</span> ( options.verbose ) {</div>
<div class="line">            <span class="keywordtype">int</span> t = Position::tz();</div>
<div class="line">            <span class="keywordtype">int</span> d = Position::dst();</div>
<div class="line">            <span class="keywordtype">int</span> a = Position::adjust();</div>
<div class="line">            <span class="keywordtype">int</span> A = Position::Adjust();</div>
<div class="line">            <span class="keywordtype">int</span> s = A     ;</div>
<div class="line">            <span class="keywordtype">int</span> h = s/3600;</div>
<div class="line">                s-= h*3600;</div>
<div class="line">                s = abs(s);</div>
<div class="line">            <span class="keywordtype">int</span> m = s/60  ;</div>
<div class="line">                s-= m*60  ;</div>
<div class="line">            printf(<span class="stringliteral">&quot;tz,dst,adjust = %d,%d,%d total = %dsecs (= %d:%d:%d)\n&quot;</span>,t,d,a,A,h,m,s);</div>
<div class="line">        }</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">        if ( options.verbose ) {</span></div>
<div class="line"><span class="comment">            printf(&quot;Time Dictionary\n&quot;);</span></div>
<div class="line"><span class="comment">            for ( TimeDict_i it = gTimeDict.begin() ;  it != gTimeDict.end() ; it++ ) {</span></div>
<div class="line"><span class="comment">                std::string sTime = getExifTime(it-&gt;first);</span></div>
<div class="line"><span class="comment">                Position*   pPos  = &amp;it-&gt;second;</span></div>
<div class="line"><span class="comment">                std::string sPos  = Position::toExifString(pPos-&gt;lat(),false,true)</span></div>
<div class="line"><span class="comment">                                  + &quot; &quot;</span></div>
<div class="line"><span class="comment">                                  + Position::toExifString(pPos-&gt;lon(),false,true)</span></div>
<div class="line"><span class="comment">                                  ;</span></div>
<div class="line"><span class="comment">                printf(&quot;%s %s\n&quot;,sTime.c_str(), sPos.c_str());</span></div>
<div class="line"><span class="comment">            }</span></div>
<div class="line"><span class="comment">        }</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> p = 0 ; p &lt; gFiles.size() ; p++ ) {</div>
<div class="line">            std::string path  = gFiles[p] ;</div>
<div class="line">            std::string stamp ;</div>
<div class="line">            <span class="keywordflow">try</span> {</div>
<div class="line">                time_t t       = readImageTime(path,&amp;stamp) ;</div>
<div class="line">                Position* pPos = searchTimeDict(gTimeDict,t,Position::deltaMax_);</div>
<div class="line">                <a class="code" href="classExiv2_1_1Image.html#a89ad3ffe7a4e8a943d267d77843415fb">Exiv2::Image::AutoPtr</a> image = <a name="a4"></a><a class="code" href="classExiv2_1_1ImageFactory.html#aba929c4ca4a71625d12bcb97bcc28161">Exiv2::ImageFactory::open</a>(path);</div>
<div class="line">                <span class="keywordflow">if</span> ( image.get() ) {</div>
<div class="line">                    image-&gt;readMetadata();</div>
<div class="line">                    <a class="code" href="classExiv2_1_1ExifData.html">Exiv2::ExifData</a>&amp; exifData = image-&gt;exifData();</div>
<div class="line">                    <span class="keywordflow">if</span> ( pPos ) {</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSProcessingMethod&quot;</span> ] = <span class="stringliteral">&quot;charset=Ascii HYBRID-FIX&quot;</span>;</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSVersionID&quot;</span>        ] = <span class="stringliteral">&quot;2 2 0 0&quot;</span>;</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSMapDatum&quot;</span>         ] = <span class="stringliteral">&quot;WGS-84&quot;</span>;</div>
<div class="line"> </div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLatitude&quot;</span>         ] = Position::toExifString(pPos-&gt;lat(),<span class="keyword">true</span>,<span class="keyword">true</span>);</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLongitude&quot;</span>        ] = Position::toExifString(pPos-&gt;lon(),<span class="keyword">true</span>,<span class="keyword">false</span>);</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSAltitude&quot;</span>         ] = Position::toExifString(pPos-&gt;ele());</div>
<div class="line"> </div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSAltitudeRef&quot;</span>      ] = pPos-&gt;ele()&lt;0.0?<span class="stringliteral">&quot;1&quot;</span>:<span class="stringliteral">&quot;0&quot;</span>;</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLatitudeRef&quot;</span>      ] = pPos-&gt;lat()&gt;0?<span class="stringliteral">&quot;N&quot;</span>:<span class="stringliteral">&quot;S&quot;</span>;</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSLongitudeRef&quot;</span>     ] = pPos-&gt;lon()&gt;0?<span class="stringliteral">&quot;E&quot;</span>:<span class="stringliteral">&quot;W&quot;</span>;</div>
<div class="line"> </div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSDateStamp&quot;</span>        ] = stamp;</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.GPSInfo.GPSTimeStamp&quot;</span>        ] = Position::toExifTimeStamp(stamp);</div>
<div class="line">                        exifData[<span class="stringliteral">&quot;Exif.Image.GPSTag&quot;</span>                ] = 4908;</div>
<div class="line"> </div>
<div class="line">                        printf(<span class="stringliteral">&quot;%s %s % 2d\n&quot;</span>,path.c_str(),pPos-&gt;toString().c_str(),pPos-&gt;delta());</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        printf(<span class="stringliteral">&quot;%s *** not in time dict ***\n&quot;</span>,path.c_str());</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">if</span> ( !options.dryrun ) image-&gt;writeMetadata();</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">catch</span> ( ... ) {};</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result ;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// That&#39;s all Folks!</span></div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aclassExiv2_1_1XmpParser_html_aea661a7039adb5a748eb7639c8ce9294"><div class="ttname"><a href="classExiv2_1_1XmpParser.html#aea661a7039adb5a748eb7639c8ce9294">Exiv2::XmpParser::initialize</a></div><div class="ttdeci">static bool initialize(XmpParser::XmpLockFct xmpLockFct=0, void *pLockData=0)</div><div class="ttdoc">Initialize the XMP Toolkit.</div></div>
<div class="ttc" id="anamespaceExiv2_html_aea35ee7a596e1d47d1ffbb553cfb688d"><div class="ttname"><a href="namespaceExiv2.html#aea35ee7a596e1d47d1ffbb553cfb688d">Exiv2::find</a></div><div class="ttdeci">const T * find(T(&amp;src)[N], const K &amp;key)</div><div class="ttdoc">Find an element that matches key in the array src.</div><div class="ttdef"><b>Definition:</b> types.hpp:497</div></div>
<div class="ttc" id="anamespaceExiv2_html"><div class="ttname"><a href="namespaceExiv2.html">Exiv2</a></div><div class="ttdoc">Provides classes and functions to encode and decode Exif and Iptc data. The libexiv2 API consists of ...</div><div class="ttdef"><b>Definition:</b> asfvideo.hpp:36</div></div>
<div class="ttc" id="aclassExiv2_1_1XmpParser_html_a46ff7c85b860ef81310e0ac8dd6b62a2"><div class="ttname"><a href="classExiv2_1_1XmpParser.html#a46ff7c85b860ef81310e0ac8dd6b62a2">Exiv2::XmpParser::terminate</a></div><div class="ttdeci">static void terminate()</div><div class="ttdoc">Terminate the XMP Toolkit and unregister custom namespaces.</div></div>
<div class="ttc" id="anamespaceExiv2_html_a64705a2301776cea1f4993d9066d44b3"><div class="ttname"><a href="namespaceExiv2.html#a64705a2301776cea1f4993d9066d44b3">Exiv2::version</a></div><div class="ttdeci">const EXIV2API char * version()</div><div class="ttdoc">Return the version of Exiv2 as &quot;C&quot; string eg &quot;0.27.0.2&quot;.</div></div>
<div class="ttc" id="anamespaceExiv2_html_a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6"><div class="ttname"><a href="namespaceExiv2.html#a5153319711f35fe81cbc13f4b852450ca8526caf002a100bd730312d45808f1b6">Exiv2::time</a></div><div class="ttdeci">@ time</div><div class="ttdoc">IPTC time type.</div><div class="ttdef"><b>Definition:</b> types.hpp:138</div></div>
<div class="ttc" id="aclassExiv2_1_1ExifData_html_a0627816364585c0579cba89e6e287d74"><div class="ttname"><a href="classExiv2_1_1ExifData.html#a0627816364585c0579cba89e6e287d74">Exiv2::ExifData::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Return true if there is no Exif metadata.</div><div class="ttdef"><b>Definition:</b> exif.hpp:512</div></div>
<div class="ttc" id="aclassExiv2_1_1Image_html_a89ad3ffe7a4e8a943d267d77843415fb"><div class="ttname"><a href="classExiv2_1_1Image.html#a89ad3ffe7a4e8a943d267d77843415fb">Exiv2::Image::AutoPtr</a></div><div class="ttdeci">std::auto_ptr&lt; Image &gt; AutoPtr</div><div class="ttdoc">Image auto_ptr type.</div><div class="ttdef"><b>Definition:</b> image.hpp:81</div></div>
<div class="ttc" id="aclassExiv2_1_1ImageFactory_html_aba929c4ca4a71625d12bcb97bcc28161"><div class="ttname"><a href="classExiv2_1_1ImageFactory.html#aba929c4ca4a71625d12bcb97bcc28161">Exiv2::ImageFactory::open</a></div><div class="ttdeci">static Image::AutoPtr open(const std::string &amp;path, bool useCurl=true)</div><div class="ttdoc">Create an Image subclass of the appropriate type by reading the specified file. Image type is derived...</div></div>
<div class="ttc" id="anamespaceExiv2_html_a5c87ddedd63e9ab9aa6f295cda32aebd"><div class="ttname"><a href="namespaceExiv2.html#a5c87ddedd63e9ab9aa6f295cda32aebd">Exiv2::readFile</a></div><div class="ttdeci">EXIV2API DataBuf readFile(const std::string &amp;path)</div><div class="ttdoc">Read file path into a DataBuf, which is returned.</div></div>
<div class="ttc" id="anamespaceExiv2_html_aeb5a1b7e0a14e8671707d5be16cbda24"><div class="ttname"><a href="namespaceExiv2.html#aeb5a1b7e0a14e8671707d5be16cbda24">Exiv2::toString</a></div><div class="ttdeci">std::string toString(const T &amp;arg)</div><div class="ttdoc">Utility function to convert the argument of any type to a string.</div><div class="ttdef"><b>Definition:</b> types.hpp:510</div></div>
<div class="ttc" id="aclassExiv2_1_1ExifData_html"><div class="ttname"><a href="classExiv2_1_1ExifData.html">Exiv2::ExifData</a></div><div class="ttdoc">A container for Exif data. This is a top-level class of the Exiv2 library. The container holds Exifda...</div><div class="ttdef"><b>Definition:</b> exif.hpp:434</div></div>
</div><!-- /.container -->
<div id="footer">
  <footer>
    <div class="container">
      <div class="row">
       <div class="page-footer">
        <div class="col-sm-5">
          Exiv2 v0.27.5.3
        </div><!-- /.col-sm-5 -->
        <div class="col-sm-2"></div><!-- /.col-sm-2 -->
        <div class="col-sm-5">
          <span class="visible-xs-block text-center"><p>Last modified 2022-02-14 01:33 UTC</p></span>
          <span class="hidden-xs pull-right"><p>Last modified 2022-02-14 01:33 UTC</p></span>
        </div><!-- /.col-sm-5 -->
       </div>
      </div><!-- /.row -->
    </div><!-- /.container -->
  </footer>
</div><!-- closes footer -->
</body>
</html>
